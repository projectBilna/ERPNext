frappe.templates["module_title"] = '<div class="mobile-module-icon pull-right small visible-xs">{%= title %}</div> <div class="mobile-title col-sm-8 col-xs-7 visible-xs"> <div class="dropdown"> <h2 class="dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true" style="cursor: pointer; margin: 15px 0px;"> <span class="active-section">{%= section_name %}</span> <span class="caret"></span> </h2> <ul class="dropdown-menu" role="menu" aria-labelledby="ModuleSections"> {% for (var i=0, l= data.data.length; i < l; i++) { var item = data.data[i]; if (item.label !== section_name) { %} <li role="presentation" data-label="{%= item.label %}"> <a role="menuitem" tabindex="-1" class="module-link">{%= item.label %}</a> </li> {% } } %} </ul> </div> </div> ';
frappe.templates["module_section"] = '<div class="module-section"> {% for(var i=0, j= data.items.length; i < j; i++) { var item = data.items[i]; %} <div class="row module-item" data-item-index={%= i %}> {% if (item.description) { %} <div class="col-xs-8"> <h4>{%= item.label || item.name %}</h4> {% if (item.type==="doctype") { %} <span class="open-notification hide" data-doctype="{%= item.name %}"></span> {% } %} <p class="text-muted small module-item-description hidden-xs">{%= item.description %}</p> </div> <div class="col-xs-4 text-muted text-right small" style="padding-top: 5px;"> {% if (item.last_modified) { %} {%= comment_when(item.last_modified) %} {% } %} </div> {% } else { %} <div class="col-xs-12"> <h4>{%= item.label || item.name %}</h4> </div> {% } %} </div> {% } %} <div class="row visible-sm visible-xs" style="padding: 15px;"> <div class="col-xs-12"> <a onclick="frappe.ui.toolbar.toggle_left_sidebar();" class="text-primary"> {%= __("More") %}</a> </div> </div> </div> ';
frappe.templates["module_sidebar"] = '<ul class="module-sidebar-nav"> <li class="divider"></li> {% for (var i=0, l= data.data.length; i < l; i++) { var item = data.data[i]; %} <li data-label="{%= item.label %}" class="strong module-sidebar-item"> <a class="module-link"> <i class="icon icon-chevron-right pull-right" style="display: none;"></i> <span>{%= item.label %}</span></a> </li> {% } %} </ul> ';
frappe.provide("frappe.views.moduleview");frappe.provide("frappe.module_page");frappe.views.ModuleFactory=frappe.views.Factory.extend({make:function(route){var module=route[1];frappe.views.moduleview[module]=parent;new frappe.views.moduleview.ModuleView(module);this.on_show();},on_show:function(){frappe.breadcrumbs.last_module=frappe.get_route()[1];}});frappe.views.moduleview.ModuleView=Class.extend({init:function(module){this.module=module;this.module_info=frappe.get_module(module)||{};this.module_label=__(this.module_info.label||this.module);this.sections={};this.current_section=null;this.make();$(".navbar-center").html(this.module_label);},make:function(){var me=this;return frappe.call({method:"frappe.desk.moduleview.get",args:{module:this.module},callback:function(r){me.data=r.message;me.parent=frappe.make_page(true);frappe.views.moduleview[me.module]=me.parent;me.page=me.parent.page;me.parent.moduleview=me;me.render();},freeze:true,});},render:function(){this.page.main.empty();this.make_sidebar();this.sections_by_label={};for(var i in this.data.data){this.sections_by_label[this.data.data[i].label]=this.data.data[i];}
this.activate(this.data.data[0].label);},make_sidebar:function(name){var me=this;var sidebar_content=frappe.render_template("module_sidebar",{data:this.data});var module_sidebar=$(sidebar_content).addClass("nav nav-pills nav-stacked").appendTo(this.page.sidebar.addClass("hidden-xs hidden-sm"));var offcanvas_module_sidebar=$(sidebar_content).addClass("list-unstyled sidebar-menu").appendTo($(".sidebar-left .module-sidebar").empty());this.sidebar=offcanvas_module_sidebar.add(module_sidebar);this.sidebar.on("click",".module-link",function(){me.activate($(this).parent().attr("data-label"));});},activate:function(name){var me=this;if(this.current_section){this.current_section.addClass("hide");}
if(!this.sections[name]){var data=this.sections_by_label[name];this.sections[name]=$(frappe.render_template("module_section",{data:data})).appendTo(this.page.main);$(this.sections[name]).find(".module-item").each(function(i,mi){var item=data.items[$(mi).attr("data-item-index")];$(mi).attr("data-route",me.get_route(item).join("/")).attr("data-label",item.name).on("click",function(event){if(event.target.classList.contains("open-notification")){var doctype=event.target.getAttribute("data-doctype");frappe.route_options=frappe.boot.notification_info.conditions[doctype];}
if(item.type==="help"){frappe.help.show_video(item.youtube_id);return false;}else{frappe.set_route(me.get_route(item));}});});}
this.page.set_title(repl('<span class="hidden-xs hidden-sm">%(module)s</span>\
   <span class="hidden-md hidden-lg">%(section)s</span>',{module:this.module_label,section:name}));this.current_section=this.sections[name];this.current_section.removeClass("hide");this.sidebar.find("li.active").removeClass("active");this.sidebar.find('[data-label="'+name+'"]').addClass("active");frappe.app.update_notification_count_in_modules();},get_route:function(item){var route=[item.route||item.link];if(!route[0]){if(item.type=="doctype"){frappe.breadcrumbs.set_doctype_module(item.name,this.module);route=["List",item.name];}else if(item.type=="page"){route=[item.name]}else if(item.type=="report"){if(item.is_query_report){route=["query-report",item.name];}else{route=["Report",item.doctype,item.name];}}}
return route;}});;